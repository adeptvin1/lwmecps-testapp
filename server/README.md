# LWMECPS Server Test App

Серверный компонент для тестирования сетевых соединений и эмуляции нагрузки.

## Особенности

- Эмуляция нагрузки CPU и RAM
- Динамическая задержка ответа в зависимости от нагрузки
- Метрики Prometheus для мониторинга
- REST API для проверки латентности

## Настройка

### Переменные окружения

| Переменная | Описание | Значение по умолчанию |
|------------|----------|----------------------|
| `host` | Хост для запуска сервера | `0.0.0.0` |
| `port` | Порт для запуска сервера | `8000` |
| `debug` | Режим отладки | `True` |
| `cpu_limit` | Лимит CPU в mCPUs | `200` |
| `ram_limit` | Лимит RAM в MB | `256` |
| `max_latency` | Максимальная задержка в секундах | `0.5` |

### Эмуляция нагрузки

Сервер эмулирует нагрузку на ресурсы следующим образом:
- Каждый запрос увеличивает нагрузку CPU и RAM на 2-10 единиц
- Нагрузка снижается на 100 единиц каждую секунду
- При нагрузке выше 70% начинает применяться задержка
- Задержка увеличивается линейно с ростом нагрузки

### API Endpoints

- `GET /api/latency` - Проверка латентности
  - Возвращает `{"message": "pong"}`
  - Время ответа зависит от текущей нагрузки

### Метрики Prometheus

- `latency_requests_per_second` - Количество запросов в секунду
- `simulated_cpu_usage` - Текущая нагрузка CPU в mCPUs
- `simulated_ram_usage` - Текущая нагрузка RAM в MB

## Запуск

```bash
# Запуск через Docker
docker-compose up server

# Запуск напрямую
python main.py
```

## Оптимизация

Для оптимизации производительности можно:
1. Уменьшить `max_latency` для более быстрых ответов
2. Увеличить порог начала задержки (сейчас 70%)
3. Настроить скорость снижения нагрузки (сейчас 100 единиц/сек)
4. Изменить прирост нагрузки (сейчас 2-10 единиц) 